(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[44],{Kq3J:function(e,t,a){"use strict";var r=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var s=r(a("bx4M"));a("g9YV");var n=r(a("wCAj"));a("P2fV");var l=r(a("NJEC"));a("+L6B");var o=r(a("2/Rp"));a("/xke");var c,d,p,u=r(a("TeRw")),h=a("MuoO"),m=a("7DNP"),f=r(a("wd/R")),g=i(a("q1tI")),S=a("LLXN"),v=r(a("puxM")),b=r(a("nvum")),E=r(a("XZXw")),_=a("vSx2"),y=r(a("QDog")),k=r(a("hMqj")),P=(c=(0,h.connect)(e=>{var t=e.list,a=e.loading,r=e.teamControl,i=e.enterprise;return{list:t,loading:a.models.list,currentTeam:r.currentTeam,currentRegionName:r.currentRegionName,currentEnterprise:i.currentEnterprise,currentTeamPermissionsInfo:r.currentTeamPermissionsInfo}}),c((p=class extends g.PureComponent{constructor(e){super(e),this.onPublishStore=(()=>{this.setState({selectStoreShow:!0})}),this.onPublishLocal=(()=>{this.handleShare("",{})}),this.onPageChange=(e=>{this.setState({page:e},()=>{this.fetchPublishRecoder()})}),this.fetchAppDetail=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.teamName,r=t.regionName,i=t.appID;this.setState({loadingDetail:!0}),e({type:"application/fetchGroupDetail",payload:{team_name:a,region_name:r,group_id:i},callback:e=>{e&&200===e._code&&this.setState({appDetail:e.bean,loadingDetail:!1})},handleError:e=>{e&&404===e.code&&this.props.dispatch(m.routerRedux.push("/team/".concat(y.default.getCurrTeamName(),"/region/").concat(y.default.getCurrRegionName(),"/apps")))}})}),this.fetchPublishRecoder=(()=>{this.setState({loading:!0});var e=this.props.match.params,t=e.teamName,a=e.appID,r=this.props.dispatch,i=this.state,s=i.page,n=i.pageSize;r({type:"application/fetchShareRecords",payload:{team_name:t,app_id:a,page:s,page_size:n},callback:e=>{e&&this.setState({recoders:e.list,loading:!1})}})}),this.handleShare=((e,t)=>{var a=this.props.match.params,r=a.teamName,i=a.appID,s=this.props.dispatch;s({type:"application/ShareGroup",payload:{team_name:r,group_id:i,scope:e,target:t},callback:e=>{this.continuePublish(e.bean.ID,e.bean.step)}})}),this.hideSelectStoreShow=(()=>{this.setState({selectStoreShow:!1})}),this.handleSelectStore=(e=>{var t=e.store_id;t||u.default.warning({message:"\u672a\u9009\u62e9\u6b63\u786e\u7684\u5e94\u7528\u5546\u5e97"}),this.handleShare("goodrain",{store_id:t})}),this.deleteRecord=(e=>{var t=this.props.match.params,a=t.teamName,r=t.appID,i=this.props.dispatch;i({type:"application/deleteShareRecord",payload:{team_name:a,app_id:r,record_id:e},callback:e=>{this.fetchPublishRecoder()}})}),this.cancelPublish=(e=>{if(void 0!=e&&""!=e){var t=this.props.match.params.teamName,a=this.props.dispatch;a({type:"application/giveupShare",payload:{team_name:t,share_id:e},callback:e=>{this.fetchPublishRecoder()}})}else u.default.warning({message:"\u53c2\u6570\u5f02\u5e38"})}),this.continuePublish=((e,t)=>{var a=this.props.dispatch,r=this.props.match.params,i=r.teamName,s=r.regionName,n=r.appID;1===t&&a(m.routerRedux.push("/team/".concat(i,"/region/").concat(s,"/apps/").concat(n,"/share/").concat(e,"/one"))),2===t&&a(m.routerRedux.push("/team/".concat(i,"/region/").concat(s,"/apps/").concat(n,"/share/").concat(e,"/two")))}),this.state={loading:!0,appDetail:{},page:1,pageSize:10,total:0,selectStoreShow:!1}}componentWillMount(){var e=this.props,t=e.currentTeamPermissionsInfo,a=e.dispatch,r=k.default.queryAppInfo(t,"share");r||y.default.withoutPermission(a)}componentDidMount(){this.fetchAppDetail(),this.fetchPublishRecoder()}render(){var e=[],t=this.state,a=t.appDetail,r=t.loading,i=t.loadingDetail,c=t.page,d=t.pageSize,p=t.total,u=t.selectStoreShow,h=t.recoders,y=this.props,k=y.currentEnterprise,P=y.currentTeam,x=y.currentRegionName,R=y.dispatch;return e=(0,_.createApp)((0,_.createTeam)((0,_.createEnterprise)(e,k),P,x),P,x,{appName:a.group_name,appID:a.group_id}),g.default.createElement(E.default,{breadcrumbList:e,loading:i,title:(0,S.formatMessage)({id:"app.publish.title"}),content:(0,S.formatMessage)({id:"app.publish.desc"}),extraContent:g.default.createElement("div",null,g.default.createElement(o.default,{style:{marginRight:8},type:"primary",onClick:this.onPublishLocal},"\u53d1\u5e03\u5230\u7ec4\u4ef6\u5e93"),g.default.createElement(o.default,{style:{marginRight:8},onClick:this.onPublishStore},"\u53d1\u5e03\u5230\u4e91\u5e94\u7528\u5546\u5e97"))},g.default.createElement(s.default,{loading:r},g.default.createElement(v.default,{sm:800},g.default.createElement(n.default,{pagination:{current:c,pageSize:d,total:p,onChange:this.onPageChange},dataSource:h||[],columns:[{title:"\u53d1\u5e03\u6a21\u7248\u540d\u79f0",dataIndex:"app_model_name",render:e=>{return e||g.default.createElement("span",{style:{color:"#999999"}},"\u672a\u6307\u5b9a")}},{title:"\u7248\u672c\u53f7(\u522b\u540d)",dataIndex:"version",align:"center",render:(e,t)=>{return e?g.default.createElement("p",{style:{marginBottom:0}},e,t.version_alias?"(".concat(t.version_alias,")"):""):g.default.createElement("span",{style:{color:"#999999"}},"\u672a\u6307\u5b9a")}},{title:"\u53d1\u5e03\u8303\u56f4",dataIndex:"scope",align:"center",render:(e,t)=>{switch(e){case"":return g.default.createElement(m.Link,{to:"/enterprise/".concat(k.enterprise_id,"/shared")},"\u5e94\u7528\u5e02\u573a");case"team":return g.default.createElement(m.Link,{to:"/enterprise/".concat(k.enterprise_id,"/shared")},"\u5e94\u7528\u5e02\u573a(\u56e2\u961f)");case"enterprise":return g.default.createElement(m.Link,{to:"/enterprise/".concat(k.enterprise_id,"/shared")},"\u5e94\u7528\u5e02\u573a(\u4f01\u4e1a)");default:return t.scope_target?g.default.createElement("p",{style:{marginBottom:0}},"\u5e94\u7528\u5546\u5e97",t.scope_target.store_name&&t.scope_target.store_name):g.default.createElement("p",{style:{marginBottom:0}},"\u5e94\u7528\u5546\u5e97")}}},{title:"\u53d1\u5e03\u65f6\u95f4",align:"center",dataIndex:"create_time",render:e=>g.default.createElement("span",null,(0,f.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:"\u72b6\u6001",align:"center",dataIndex:"status",render:e=>{switch(e){case 0:return"\u53d1\u5e03\u4e2d";case 1:return g.default.createElement("span",{style:{color:"green"}},"\u53d1\u5e03\u5b8c\u6210");case 2:return g.default.createElement("span",{style:{color:"#999999"}},"\u5df2\u53d6\u6d88")}}},{title:"\u64cd\u4f5c",width:"200px",dataIndex:"dataIndex",render:(e,t)=>{return g.default.createElement("div",null,0==t.status?g.default.createElement("div",null,g.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.continuePublish(t.record_id,t.step)}},"\u7ee7\u7eed\u53d1\u5e03"),g.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.cancelPublish(t.record_id)}},"\u53d6\u6d88\u53d1\u5e03")):g.default.createElement(l.default,{title:"\u786e\u8ba4\u8981\u5220\u9664\u5f53\u524d\u8bb0\u5f55\u5417?",onConfirm:()=>{this.deleteRecord(t.record_id)},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},g.default.createElement("a",{href:"#"},"\u5220\u9664")))}}]}))),g.default.createElement(b.default,{dispatch:R,enterprise_id:k.enterprise_id,visible:u,onCancel:this.hideSelectStoreShow,onOk:this.handleSelectStore}))}},d=p))||d);t.default=P},nvum:function(e,t,a){"use strict";var r=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=r(a("kLXV")),n=r(a("jehZ"));a("+L6B");var l=r(a("2/Rp"));a("OaEy");var o=r(a("2fM7"));a("y8nQ");var c,d,p,u=r(a("Vl3Y")),h=i(a("q1tI")),m=r(a("e6Ls")),f=a("34ay"),g=u.default.Item,S=o.default.Option,v=(c=u.default.create(),c((p=class extends h.PureComponent{constructor(e){super(e),this.getStoreList=(()=>{this.setState({loading:!0});var e=this.props,t=e.dispatch,a=e.enterprise_id;t({type:"enterprise/fetchEnterpriseStoreList",payload:{enterprise_id:a},callback:e=>{if(e){var t=e.list,a=void 0===t?[]:t,r=[];a.length>0&&(r=a.filter(e=>1==e.status&&(0,f.fetchMarketAuthority)(e,"Write"))),this.setState({storeList:r,loading:!1})}}})}),this.handleSubmit=(()=>{var e=this.props,t=e.onOk,a=e.form,r=a.validateFields;r((e,a)=>{e||t&&t(a)})}),this.state={actions:[],storeList:[]}}componentDidMount(){this.getStoreList()}render(){var e=this.props,t=e.onCancel,a=e.visible,r=e.form,i=r.getFieldDecorator,c=this.state.storeList,d=c&&c.length>0&&c,p={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}};return h.default.createElement(s.default,{title:"\u9009\u62e9\u5e94\u7528\u5546\u5e97",visible:a,className:m.default.TelescopicModal,onOk:this.handleSubmit,onCancel:t,footer:[h.default.createElement(l.default,{onClick:t}," \u53d6\u6d88 "),d&&h.default.createElement(l.default,{type:"primary",onClick:this.handleSubmit},"\u786e\u5b9a")]},d?h.default.createElement(u.default,{onSubmit:this.handleSubmit,layout:"horizontal",hideRequiredMark:!0},h.default.createElement(g,(0,n.default)({},p,{label:"\u53d1\u5e03\u5546\u5e97",hasFeedback:!0}),i("store_id",{initialValue:d[0].name||"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u53d1\u5e03\u7684\u5546\u5e97"}]})(h.default.createElement(o.default,{placeholder:"\u8bf7\u9009\u62e9\u53d1\u5e03\u7684\u5546\u5e97"},d.map((e,t)=>{var a=e.name,r=e.alias;return h.default.createElement(S,{key:"store".concat(t),value:a},r||a)}))),h.default.createElement("div",{className:m.default.conformDesc},"\u9009\u62e9\u9700\u8981\u53d1\u5e03\u7684\u5546\u5e97\u540d\u79f0"))):h.default.createElement("p",{style:{textAlign:"center"}},"\u6682\u65e0\u63a8\u9001\u6743\u9650\u7684\u5e94\u7528\u5546\u5e97"))}},d=p))||d),b=v;t.default=b}}]);