(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"+EK0":function(e,t,a){"use strict";(function(e){var s=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var r=s(a("bx4M"));a("+L6B");var o=s(a("2/Rp"));a("Pwec");var l=s(a("CtXQ")),n=s(a("p0pE"));a("2qtc");var u=s(a("kLXV"));a("y8nQ");var d,c,m,p,h,f,g=s(a("Vl3Y")),C=i(a("q1tI")),v=a("MuoO"),y=s(a("ALo4")),k=a("7DNP"),E=s(a("XZXw")),_=a("4/zt"),b=s(a("QDog")),S=s(a("0zE7")),I=s(a("+iC2")),w=s(a("rIpq")),N=s(a("mWxT")),T=s(a("q76B")),D=s(a("9tdr"));a("ztCB"),a("p77/"),a("ToSm");var A=(d=g.default.create(),d((m=class extends C.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props.form;t.validateFields((e,t)=>{e||this.props.onSubmit&&this.props.onSubmit(t)})}),this.state={compose:""}}componentDidMount(){(0,_.getComposeByComposeId)({team_name:b.default.getCurrTeamName(),compose_id:this.props.compose_id}).then(e=>{e&&e.bean&&this.setState({compose:e.bean.compose_content})})}render(){var e=this.props.form,t=e.getFieldDecorator,a=(e.getFieldValue,this.props.data,{lineNumbers:!0,theme:"monokai",mode:"yaml"});return this.state.compose?C.default.createElement(u.default,{visible:!0,title:"\u4fee\u6539compose\u5185\u5bb9",onOk:this.handleSubmit,onCancel:this.props.onCancel},C.default.createElement(g.default,{onSubmit:this.handleSubmit,layout:"horizontal",hideRequiredMark:!0},C.default.createElement(g.default.Item,null,t("yaml_content",{initialValue:this.state.compose||"",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5185\u5bb9"}]})(C.default.createElement(D.default,{options:a,placeholder:""}))))):null}},c=m))||c),P=(p=(0,v.connect)(t=>{var a=t.user;t.appControl;return{currUser:a.currentUser,rainbondInfo:e.rainbondInfo}},null,null,{withRef:!0}),p((f=class extends C.PureComponent{constructor(e){super(e),this.getCheckuuid=(()=>{this.getAppAlias();var e=b.default.getCurrTeamName(),t=this.getParams();(0,_.getComposeCheckuuid)((0,n.default)({team_name:e},t)).then(e=>{e&&(e.bean.check_uuid?(this.state.check_uuid=e.bean.check_uuid,this.loopStatus()):this.startCheck())})}),this.startCheck=(e=>{var t=this.getAppAlias(),a=b.default.getCurrTeamName(),s=this.getParams();(0,_.getCreateComposeCheckInfo)((0,n.default)({team_name:a,app_alias:t},s),e=>{404===e.status&&this.props.dispatch(k.routerRedux.replace("/team/".concat(b.default.getCurrTeamName(),"/region/").concat(b.default.getCurrRegionName(),"/exception/404")))}).then(t=>{t&&(this.state.check_uuid=t.bean.check_uuid,this.setState({eventId:t.bean.check_event_id,appDetail:t.bean}),!1!==e&&this.loopStatus())})}),this.loopStatus=(()=>{if(this.mount){var e=this.getParams(),t=b.default.getCurrTeamName();(0,_.getCreateComposeCheckResult)((0,n.default)({team_name:t,check_uuid:this.state.check_uuid},e)).then(e=>{if(e&&this.mount){var t=e.bean.check_status,a=e.bean.error_infos||[],s=e.bean.service_info||[];this.setState({status:t,errorInfo:a,serviceInfo:s})}}).finally(()=>{this.mount&&"checking"===this.state.status&&setTimeout(()=>{this.loopStatus()},5e3)})}}),this.handleCreate=(()=>{this.getAppAlias()}),this.showModifyCompose=(()=>{this.setState({modifyCompose:!0})}),this.renderError=(()=>{var e=this.state.errorInfo,t=C.default.createElement("div",null,e.map(e=>{return C.default.createElement("div",{style:{marginBottom:16}},C.default.createElement(l.default,{style:{color:"#f5222d",marginRight:8},type:"close-circle-o"}),C.default.createElement("span",{dangerouslySetInnerHTML:{__html:"<span>".concat(e.error_info||""," ").concat(e.solve_advice||"","</span>")}}))})),a=[C.default.createElement(o.default,{onClick:this.showDelete,type:"default"}," ","\u653e\u5f03\u521b\u5efa"," "),C.default.createElement(o.default,{onClick:this.recheck,type:"primary"},"\u91cd\u65b0\u68c0\u6d4b")];return C.default.createElement(y.default,{type:"error",title:"\u7ec4\u4ef6\u68c0\u6d4b\u672a\u901a\u8fc7",description:"\u8bf7\u6838\u5bf9\u5e76\u4fee\u6539\u4ee5\u4e0b\u4fe1\u606f\u540e\uff0c\u518d\u91cd\u65b0\u68c0\u6d4b\u3002",extra:t,actions:a,style:{marginTop:48,marginBottom:16}})}),this.handleSetting=(()=>{var e=this.getParams();this.props.dispatch(k.routerRedux.push("/team/".concat(b.default.getCurrTeamName(),"/region/").concat(b.default.getCurrRegionName(),"/create/create-compose-setting/").concat(e.group_id,"/").concat(e.compose_id)))}),this.handleBuild=(()=>{var e=b.default.getCurrTeamName(),t=(this.state.appDetail,this.getParams());this.props.dispatch({type:"application/buildCompose",payload:(0,n.default)({team_name:b.default.getCurrTeamName()},t),callback:()=>{this.props.dispatch({type:"global/fetchGroups",payload:{team_name:e}}),this.props.dispatch(k.routerRedux.replace("/team/".concat(b.default.getCurrTeamName(),"/region/").concat(b.default.getCurrRegionName(),"/apps/").concat(t.group_id)))}})}),this.renderSuccessInfo=(e=>{if(e.value)return"string"===typeof e.value?C.default.createElement("div",{style:{paddingLeft:32}},C.default.createElement("span",{style:{verticalAlign:"top",display:"inline-block",fontWeight:"bold"}},e.key,"\uff1a"),e.value):C.default.createElement("div",{style:{paddingLeft:32}},C.default.createElement("span",{style:{verticalAlign:"top",display:"inline-block",fontWeight:"bold"}},e.key,"\uff1a"),C.default.createElement("div",{style:{display:"inline-block"}},(e.value||[]).map(e=>{return C.default.createElement("p",{style:{marginBottom:0}},e)})))}),this.renderSuccess=(()=>{var e=this.props.rainbondInfo,t=this.state.serviceInfo||[],a=C.default.createElement("div",null,t.map(e=>{return C.default.createElement("div",{style:{marginBottom:16}},C.default.createElement("p",null,"\u7ec4\u4ef6\u540d\u79f0\uff1a",e.service_cname),(e.service_info||[]).map(e=>{return C.default.createElement("div",{style:{marginBottom:16}},this.renderSuccessInfo(e))}))})),s=[C.default.createElement(o.default,{onClick:this.handleBuild,type:"primary"}," ","\u6784\u5efa\u7ec4\u4ef6"," "),C.default.createElement(o.default,{type:"default",onClick:this.handleSetting},"\u9ad8\u7ea7\u8bbe\u7f6e"),C.default.createElement(o.default,{onClick:this.showDelete,type:"default"}," ","\u653e\u5f03\u521b\u5efa"," ")];return C.default.createElement(y.default,{type:"success",title:"\u7ec4\u4ef6\u68c0\u6d4b\u901a\u8fc7",description:C.default.createElement("div",null,C.default.createElement("div",null,"\u7ec4\u4ef6\u68c0\u6d4b\u901a\u8fc7\u4ec5\u4ee3\u8868\u5e73\u53f0\u53ef\u4ee5\u68c0\u6d4b\u5230\u4ee3\u7801\u8bed\u8a00\u7c7b\u578b\u548c\u4ee3\u7801\u6e90\u3002"),"90%\u4ee5\u4e0a\u7684\u7528\u6237\u5728\u68c0\u6d4b\u901a\u8fc7\u540e\u53ef\u90e8\u7f72\u6210\u529f\uff0c\u5982\u9047\u90e8\u7f72\u5931\u8d25\uff0c\u53ef\u53c2\u8003"," ",C.default.createElement("a",{href:"".concat(N.default.documentPlatform_url(e),"docs/user-manual/app-creation/language-support/"),target:"_blank"},"rainbond\u6587\u6863")," ","\u5bf9\u4ee3\u7801\u5305\u8fdb\u884c\u8c03\u6574\u3002"),extra:a,actions:s,style:{marginTop:48,marginBottom:16}})}),this.renderChecking=(()=>{var e=C.default.createElement(o.default,{onClick:this.showDelete,type:"default"},"\u653e\u5f03\u521b\u5efa"),t=C.default.createElement("div",null,this.state.eventId&&C.default.createElement(S.default,{socketUrl:this.socketUrl,eventId:this.state.eventId}));return C.default.createElement(y.default,{type:"ing",title:"\u7ec4\u4ef6\u6784\u5efa\u6e90\u68c0\u6d4b\u4e2d...",extra:t,description:"\u6b64\u8fc7\u7a0b\u53ef\u80fd\u6bd4\u8f83\u8017\u65f6\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85",actions:e,style:{marginTop:48,marginBottom:16}})}),this.recheck=(()=>{this.setState({status:"checking"},()=>{this.startCheck()})}),this.cancelModifyCompose=(()=>{this.setState({modifyCompose:!1})}),this.handleClick=(e=>{var t=e.target;while(t){if(t===document.body)return;var a=t.getAttribute("action_type");if("modify_compose"===a)return void this.setState({modifyCompose:!0});t=t.parentNode}}),this.handleModifyCompose=(e=>{var t=this.getParams();this.props.dispatch({type:"application/editAppCreateCompose",payload:{team_name:b.default.getCurrTeamName(),group_id:t.group_id,compose_content:e.yaml_content},callback:e=>{this.cancelModifyCompose()}})}),this.handleCancelEdit=(()=>{this.setState({showEdit:!1})}),this.handleCancelShowKey=(()=>{this.setState({showKey:!1})}),this.bindEvent=(()=>{document.addEventListener("click",this.handleClick,!1)}),this.unbindEvent=(()=>{document.removeEventListener("click",this.handleClick)}),this.handleDelete=(()=>{var e=this.getParams();this.props.dispatch({type:"application/deleteCompose",payload:(0,n.default)({team_name:b.default.getCurrTeamName()},e),callback:()=>{this.props.dispatch({type:"global/fetchGroups",payload:{team_name:b.default.getCurrTeamName()}}),this.props.dispatch(k.routerRedux.replace("/team/".concat(b.default.getCurrTeamName(),"/region/").concat(b.default.getCurrRegionName(),"/index")))}})}),this.showDelete=(()=>{this.setState({showDelete:!0})}),this.state={status:"",check_uuid:"",group_id:"",compose_id:"",errorInfo:[],serviceInfo:[],showEdit:!1,showDelete:!1,modifyCompose:!1},this.mount=!1,this.socketUrl="";var t=b.default.getCurrTeamName(),a=b.default.getCurrRegionName(),s=I.default.hasTeamAndRegion(this.props.currUser,t,a);s&&(this.socketUrl=w.default.getEventWebSocketUrl(s))}componentDidMount(e){b.default.getCurrTeamName();this.getCheckuuid(),this.mount=!0,this.bindEvent()}getAppAlias(){return this.props.match.params.appAlias}componentWillUnmount(){this.mount=!1,this.unbindEvent()}getParams(){return{group_id:this.props.match.params.appID,compose_id:this.props.match.params.composeId}}render(){var e=this.state.status,t=this.getParams();return C.default.createElement(E.default,null,C.default.createElement(r.default,{bordered:!1},C.default.createElement("div",{style:{minHeight:400}},"checking"===e?this.renderChecking():null,"success"===e?this.renderSuccess():null,"failure"===e?this.renderError():null)),this.state.modifyCompose?C.default.createElement(A,{compose_id:t.compose_id,onSubmit:this.handleModifyCompose,onCancel:this.cancelModifyCompose}):null,this.state.showDelete&&C.default.createElement(T.default,{onOk:this.handleDelete,title:"\u653e\u5f03\u521b\u5efa",subDesc:"\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d",desc:"\u786e\u5b9a\u8981\u653e\u5f03\u521b\u5efa\u6b64\u7ec4\u4ef6\u5417\uff1f",onCancel:()=>{this.setState({showDelete:!1})}}))}},h=f))||h);t.default=P}).call(this,a("yLpj"))}}]);