(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[53],{MMaT:function(t,e,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("IzEo");var i=s(a("bx4M"));a("+L6B");var n=s(a("2/Rp"));a("Pwec");var h,l,u,c,o,d,p=s(a("CtXQ")),m=r(a("q1tI")),f=a("MuoO"),S=a("7DNP"),g=s(a("ALo4")),v=s(a("XZXw")),E=s(a("q76B")),y=s(a("QDog")),k=(s(a("xvIM")),s(a("0zE7"))),C=s(a("+iC2")),I=s(a("rIpq")),b=(h=(0,f.connect)(t=>{var e=t.user,a=(t.appControl,t.loading);return{currUser:e.currentUser,loading:a}}),h((u=class extends m.default.Component{constructor(t){super(t),this.componentDidMount=(()=>{this.mount=!0,this.checkStatus()}),this.checkStatus=(()=>{this.state.data;var t=this.state.status;"not_start"===t&&this.props.receiveStartShare&&this.props.receiveStartShare(this.startShareEvent),"start"===t&&this.getShareStatus(),"success"===t&&this.onSuccess(),"failure"===t&&this.onFail()}),this.componentWillUnmount=(()=>{this.mount=!1}),this.onSuccess=(()=>{this.props.onSuccess&&this.props.onSuccess()}),this.onFail=(()=>{this.props.onFail&&this.props.onFail(this)}),this.reStart=(()=>{this.setState({eventId:""}),this.startShareEvent()}),this.getShareStatus=(()=>{"start"===this.state.status&&this.mount&&this.props.dispatch({type:"plugin/getShareOneEventInfo",payload:{team_name:y.default.getCurrTeamName(),shareId:this.props.share_id,eventId:this.state.data.ID},callback:t=>{t&&this.setState({status:t.bean.event_status},()=>{"success"===this.state.status&&this.onSuccess(),"failure"===this.state.status&&this.onFail(),setTimeout(()=>{this.getShareStatus()},5e3)})}})}),this.startShareEvent=(()=>{this.props.dispatch({type:"plugin/startShareOneEvent",payload:{team_name:y.default.getCurrTeamName(),shareId:this.props.share_id,eventId:this.state.data.ID},callback:t=>{t&&this.setState({eventId:t.bean.event_id,status:t.bean.event_status},()=>{this.getShareStatus(),this.props.onStartSuccess&&this.props.onStartSuccess()})}})}),this.renderStatus=(()=>{return"start"===this.state.status?m.default.createElement(p.default,{type:"sync",className:"roundloading"}):"success"===this.state.status?m.default.createElement(p.default,{type:"check-circle",style:{color:"#52c41a"}}):"failure"===this.state.status?m.default.createElement(p.default,{type:"close-circle"}):null}),this.state={data:this.props.data||{},eventId:this.props.data.event_id||"",status:this.props.data.event_status||"not_start"},this.mount=!1;var e=y.default.getCurrTeamName(),a=y.default.getCurrRegionName(),s=C.default.hasTeamAndRegion(this.props.currUser,e,a);s&&(this.socketUrl=I.default.getEventWebSocketUrl(s))}render(){var t=this.state.data||{},e=this.state.eventId;return m.default.createElement("div",{style:{marginBottom:24}},m.default.createElement("h4",null,"\u63d2\u4ef6\u540d\u79f0: ",t.plugin_name,this.renderStatus()),m.default.createElement("div",null,e&&m.default.createElement(k.default,{socketUrl:this.socketUrl,eventId:e})))}},l=u))||l),_=(c=(0,f.connect)(t=>{t.user,t.appControl;var e=t.loading;return{loading:e}}),c((d=class extends m.PureComponent{constructor(t){super(t),this.receiveStartShare=(t=>{this.state.startShareCallback.push(t),this.state.isStart||(this.state.isStart=!0,t())}),this.handleStartShareSuccess=(()=>{this.state.startShareCallback.shift(),this.state.startShareCallback[0]&&this.state.startShareCallback[0]()}),this.getShareEventInfo=(()=>{var t=this.getParams();this.props.dispatch({type:"plugin/getShareEventInfo",payload:{team_name:y.default.getCurrTeamName(),shareId:t.shareId},callback:t=>{t&&this.setState({shareEventList:t.bean.event_list||[],status:t.bean.is_compelte?"success":"checking"})}})}),this.getParams=(()=>{return{shareId:this.props.match.params.shareId,groupId:this.props.match.params.appID}}),this.handleSuccess=(()=>{this.state.successNum++,this.state.successNum===this.state.shareEventList.length&&this.setState({status:"success"})}),this.handleFail=(t=>{this.fails.push(t),this.setState({status:"failure"})}),this.renderChecking=(()=>{}),this.renderError=(()=>{var t=m.default.createElement("div",null),e=[m.default.createElement(n.default,{onClick:this.showDelete,type:"default"}," ","\u653e\u5f03\u521b\u5efa"," "),m.default.createElement(n.default,{onClick:this.recheck,type:"primary"},"\u91cd\u65b0\u68c0\u6d4b")];return m.default.createElement(g.default,{type:"error",title:"\u63d2\u4ef6\u5206\u4eab\u5931\u8d25",description:"\u8bf7\u6838\u5bf9\u5e76\u4fee\u6539\u4ee5\u4e0b\u4fe1\u606f\u540e\uff0c\u518d\u91cd\u65b0\u68c0\u6d4b\u3002",extra:t,actions:e,style:{marginTop:48,marginBottom:16}})}),this.renderSuccess=(()=>{var t=m.default.createElement("div",null),e=[m.default.createElement(n.default,{onClick:this.handleBuild,type:"primary"}," ","\u5b8c\u6210\u5206\u4eab\u6d41\u7a0b"," "),m.default.createElement(n.default,{onClick:this.showDelete,type:"default"}," ","\u653e\u5f03\u521b\u5efa"," ")];return m.default.createElement(g.default,{type:"success",title:"\u63d2\u4ef6\u5206\u4eab\u6210\u529f",description:"\u60a8\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c",extra:t,actions:e,style:{marginTop:48,marginBottom:16}})}),this.handleReStart=(()=>{this.fails.length&&(this.fails.forEach((t,e)=>{t.reStart()}),this.fails=[],this.setState({status:"checking"}))}),this.handleCompleteShare=(()=>{var t=this.getParams(),e=this.state.shareEventList;this.props.dispatch({type:"global/complatePluginShare",payload:{team_name:y.default.getCurrTeamName(),share_id:t.shareId},callback:t=>{this.props.dispatch(S.routerRedux.replace("/team/".concat(y.default.getCurrTeamName(),"/region/").concat(y.default.getCurrRegionName(),"/source/plugin/").concat(encodeURIComponent(e[0].plugin_name))))}})}),this.handleGiveup=(()=>{var t=this.props.match.params.pluginId,e=this.props.dispatch;e({type:"plugin/giveupSharePlugin",payload:{team_name:y.default.getCurrTeamName(),share_id:this.props.match.params.shareId},callback:a=>{e(S.routerRedux.push("/team/".concat(y.default.getCurrTeamName(),"/region/").concat(y.default.getCurrRegionName(),"/myplugns/").concat(t)))}})}),this.renderBody=(()=>{var t=this.getParams(),e=this.state.shareEventList,a=this.state.status,s=(this.props.loading,m.default.createElement("div",null,(e||[]).map(e=>{return m.default.createElement(b,{receiveStartShare:this.receiveStartShare,onStartSuccess:this.handleStartShareSuccess,onFail:this.handleFail,onSuccess:this.handleSuccess,share_id:t.shareId,data:e})}))),r="",i="",h="",l=[];return"success"===a&&(r="success",i="\u63d2\u4ef6\u53d1\u5e03\u6210\u529f",h="",l=[m.default.createElement(n.default,{onClick:this.handleCompleteShare,type:"primary"}," ","\u786e\u8ba4\u53d1\u5e03"," ")]),"checking"===a&&(r="ing",i="\u63d2\u4ef6\u53d1\u5e03\u4e2d",h="\u6b64\u8fc7\u7a0b\u53ef\u80fd\u6bd4\u8f83\u8017\u65f6\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85",l=[m.default.createElement(n.default,{onClick:this.showDelete,type:"default"},"\u653e\u5f03\u53d1\u5e03")]),"failure"===a&&(r="error",h="\u8bf7\u67e5\u770b\u4ee5\u4e0b\u65e5\u5fd7\u786e\u8ba4\u95ee\u9898\u540e\u91cd\u65b0\u540c\u6b65",l=[m.default.createElement(n.default,{onClick:this.handleReStart,type:"primary"}," ","\u91cd\u65b0\u53d1\u5e03"," "),m.default.createElement(n.default,{onClick:this.showDelete,type:"default"},"\u653e\u5f03\u53d1\u5e03")]),m.default.createElement(g.default,{type:r,title:i,extra:s,description:h,actions:l,style:{marginTop:48,marginBottom:16}})}),this.showDelete=(()=>{this.setState({showDelete:!0})}),this.hideShowDelete=(()=>{this.setState({showDelete:!1})}),this.state={status:"checking",shareEventList:[],successNum:0,showDelete:!1,startShareCallback:[],isStart:!1},this.fails=[],this.mount=!1}componentDidMount(){this.mount=!0,this.getShareEventInfo()}componentWillUnmount(){this.mount=!1}render(){var t=this.props.loading,e=this.state.shareEventList;return e.length?m.default.createElement(v.default,null,m.default.createElement(i.default,{bordered:!1},this.renderBody(),"checking"===status&&this.renderChecking(),"failure"===status&&this.renderSuccess(),"failure"===status&&this.renderError()),this.state.showDelete&&m.default.createElement(E.default,{disabled:t.effects["application/giveupShare"],onOk:this.handleGiveup,onCancel:this.hideShowDelete,title:"\u653e\u5f03\u5206\u4eab",desc:"\u786e\u5b9a\u8981\u653e\u5f03\u6b64\u6b21\u5206\u4eab\u5417?"})):null}},o=d))||o);e.default=_}}]);