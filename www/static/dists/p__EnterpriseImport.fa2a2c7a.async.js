(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[27],{AkSM:function(e,t,a){e.exports={tit:"tit___AJoBY",upText:"upText___25PJ2",mb10:"mb10___3z1Aa",rl:"rl___nfYuz",box:"box___3iPdf",con:"con___3LnAo",desc:"desc___1V9Za",btn:"btn___77hST"}},NlwA:function(e,t,a){"use strict";var s=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("+L6B");var r=s(a("2/Rp"));a("OaEy");var l=s(a("2fM7"));a("7Kak");var n=s(a("9yH6"));a("sRBo");var u=s(a("kaz8"));a("DZo9");var d=s(a("8z0m"));a("Pwec");var o=s(a("CtXQ"));a("MXD1");var p=s(a("CFYs"));a("IzEo");var c=s(a("bx4M"));a("14J3");var m=s(a("BMrR"));a("jCWc");var h=s(a("kPKH"));a("/xke");var f=s(a("TeRw"));a("5NDa");var _,v,y,g=s(a("5rEg")),b=a("MuoO"),E=a("7DNP"),k=i(a("q1tI")),x=s(a("XZXw")),S=s(a("+iC2")),I=s(a("AkSM")),C=(g.default.Search,_=(0,b.connect)(e=>{var t=e.user,a=e.global;return{user:t.currentUser,rainbondInfo:a.rainbondInfo}}),_((y=class extends k.PureComponent{constructor(e){super(e),this.cancelImport=(()=>{var e=this.props,t=e.dispatch,a=(e.user,e.match.params.eid);t({type:"market/cancelImportApp",payload:{enterprise_id:a,event_id:this.state.event_id},callback:e=>{e&&(f.default.success({message:"\u53d6\u6d88\u6210\u529f"}),t(E.routerRedux.push("/enterprise/".concat(a,"/shared"))))}})}),this.complete=(()=>{this.props.onOK&&this.props.onOK()}),this.closeAutoQuery=(()=>{this.timer&&clearTimeout(this.timer),this.setState({autoQuery:!1})}),this.handleOk=(()=>{var e=this.state.fileList;if(0!=e.length){var t=e[0].name,a=e[0].response.data.bean.event_id;this.props.dispatch({type:"market/importApp",payload:{scope:"enterprise",event_id:a,file_name:t},callback:e=>{e&&(f.default.success({message:"\u64cd\u4f5c\u6210\u529f\uff0c\u6b63\u5728\u5bfc\u5165"}),this.props.onOk&&this.props.onOk(e))}})}else f.default.info({message:"\u60a8\u8fd8\u6ca1\u6709\u4e0a\u4f20\u6587\u4ef6"})}),this.onChangeUpload=(e=>{var t=this.state.autoQuery,a=e.fileList;a=a.filter(e=>{return!e.response||"success"===e.response.msg}),e&&e.event&&e.event.percent&&this.setState({percents:e.event.percent});var s=e.file.status;"done"===s?this.setState({percents:!1}):!t&&this.openAutoQuery(),this.setState({fileList:a})}),this.onRemove=(()=>{this.setState({fileList:[]})}),this.onFileChange=(e=>{this.setState({file_list:e})}),this.openAutoQuery=(()=>{this.setState({autoQuery:!0}),this.handleQueryImportDir()}),this.openQueryImportStatus=(()=>{this.queryImportStatus()}),this.handleSubmit=(()=>{var e=this.props.match.params.eid,t=this.state,a=t.scopeValue,s=t.tenant_name,i=t.event_id,r=t.file_list;if(0===r.length)return f.default.destroy(),void f.default.warning({message:"\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5e94\u7528"});if(""===s&&"enterprise"!==a)return f.default.destroy(),f.default.warning({message:"\u8bf7\u9009\u62e9\u4e00\u4e2a\u56e2\u961f"}),null;var l="";r.map(e=>{l+="".concat(e,",")}),l=l.slice(0,l.length-1),this.props.dispatch({type:"market/importApp",payload:{scope:a,tenant_name:s,enterprise_id:e,event_id:i,file_name:l},callback:e=>{e&&(f.default.success({message:"\u5f00\u59cb\u5bfc\u5165\u5e94\u7528"}),this.closeAutoQuery(),this.openQueryImportStatus())}})}),this.queryImportRecord=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"market/queryImportRecord",payload:{enterprise_id:a},callback:e=>{e&&200===e._code&&this.setState({record:e.bean,event_id:e.bean.event_id,region_name:e.bean&&e.bean.region_name},()=>{this.openQueryImportStatus(),this.handleQueryImportDir(!0)})}})}),this.queryImportStatus=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"market/queryImportApp",payload:{enterprise_id:a,event_id:this.state.event_id},callback:e=>{if(e&&200===e._code){if(this.setState({import_file_status:e.list}),e.bean&&"uploading"==e.bean.status)return;if(e.bean&&"partial_success"==e.bean.status)return void f.default.success({message:"\u90e8\u5206\u5e94\u7528\u5bfc\u5165\u5931\u8d25\uff0c\u4f60\u53ef\u4ee5\u91cd\u8bd5\u6216\u53d6\u6d88\u5bfc\u5165"});if(e.bean&&"success"==e.bean.status)return f.default.success({message:"\u5bfc\u5165\u5b8c\u6210"}),void t(E.routerRedux.push("/enterprise/".concat(a,"/shared")));if(e.bean&&"failed"==e.bean.status)return f.default.warning({message:"\u5e94\u7528\u5bfc\u5165\u5931\u8d25"}),void this.setState({import_file_status:[]});setTimeout(()=>{this.queryImportStatus()},2e3)}}})}),this.handleQueryImportDir=(e=>{var t=this.props,a=t.dispatch,s=t.match.params.eid,i=this.state.autoQuery;(e||i)&&a({type:"market/queryImportDirApp",payload:{enterprise_id:s,event_id:this.state.event_id},callback:e=>{e&&this.setState({existFileList:e.list});var t=this;i&&(this.timer=setTimeout(function(){t.handleQueryImportDir()},8e3))}})}),this.onChange=(e=>{console.log("checked = ",e)}),this.onChangeRadio=(e=>{this.setState({scopeValue:e.target.value})}),this.getUserTeams=(()=>{var e=this.props,t=e.dispatch,a=e.user,s=e.match.params.eid;t({type:"global/fetchUserTeams",payload:{enterprise_id:s,user_id:a.user_id,page:1,page_size:999},callback:e=>{e&&200===e._code&&this.setState({userTeamList:e.list})}})}),this.handleChangeTeam=(e=>{this.setState({tenant_name:e})});var t=this.props.user,a=S.default.isCompanyAdmin(t);this.state={enterpriseAdmin:a,fileList:[],existFileList:[],record:{},event_id:"",file_list:[],import_file_status:[],userTeamList:[],autoQuery:!1,scopeValue:a?"enterprise":"team",tenant_name:"",percents:!1,region_name:""}}componentDidMount(){this.queryImportRecord(),this.getUserTeams()}componentWillUnmount(){this.timer&&clearTimeout(this.timer)}render(){var e=()=>k.default.createElement("svg",{t:"1582646117495",viewBox:"0 0 1026 1024","p-id":"5405",width:"23",height:"23"},k.default.createElement("path",{d:"M536.149154 400.348544c56.251093 47.113428 112.500379 94.243113 168.749666 141.372797 20.850997 17.471561 22.241786 33.339199 4.763001 54.179359-17.460724 20.858222-33.353649 22.249011-54.20284 4.779257-34.630646-29.020528-69.259485-58.042862-103.906387-87.045328v448.330764c0 27.203471-11.259972 38.458025-38.477893 38.458024-27.201665 0-38.477893-11.254553-38.477894-38.458024V513.634629a541926.23157 541926.23157 0 0 0-103.906387 87.045328c-20.850997 17.469755-36.72586 16.078966-54.206452-4.779257-17.478786-20.84016-16.086191-36.707798 4.763001-54.179359 56.252899-47.129684 112.502185-94.259369 168.751472-141.372797 16.660568-13.953045 29.490145-13.953045 46.150713 0z",fill:"#4D73B1","p-id":"5406"}),k.default.createElement("path",{d:"M923.532655 8.543418H102.61494C45.939386 8.543418 0 54.477385 0 111.113203v512.865179c0 56.632205 45.939386 102.569785 102.61494 102.569784h217.178022c27.216115 0 38.494149-11.272616 38.494149-38.476087 0-27.187215-11.276228-38.459831-38.494149-38.459831H102.61494c-18.148893 0-25.662766-7.506648-25.662766-25.63206V111.115009c0-18.125412 7.513873-25.633867 25.662766-25.633867h820.917715c18.148893 0 25.66096 7.508454 25.66096 25.633867v512.865179c0 18.125412-7.512067 25.63206-25.66096 25.63206H706.356439c-27.216115 0-38.494149 11.272616-38.494149 38.459831 0 27.205278 11.276228 38.476087 38.494149 38.476087h217.176216c56.675554 0 102.61494-45.93758 102.61494-102.569784V111.113203c0-56.635817-45.939386-102.569785-102.61494-102.569785z",fill:"#4D73B1","p-id":"5407"})),t={},a=this.state,s=a.existFileList,i=a.percents,f=a.userTeamList,_=a.record,v=a.region_name,y=a.enterpriseAdmin,g=this.props,b=(g.rainbondInfo,g.match.params.eid,s&&s.length>0&&s),E={display:"block",height:"30px",lineHeight:"30px"},S=f&&f.length>0&&f;return k.default.createElement(x.default,{title:"\u79bb\u7ebf\u5e94\u7528\u6a21\u7248\u5bfc\u5165",content:"\u79bb\u7ebf\u5e94\u7528\u6a21\u7248\u5bfc\u5165\u662f\u521b\u5efa\u672c\u5730\u5171\u4eab\u5e93\u5e94\u7528\u6a21\u578b\u7684\u65b9\u5f0f\u4e4b\u4e00\uff0c\u79bb\u7ebf\u5e94\u7528\u5305\u53ef\u4ee5\u6765\u81ea\u5176\u4ed6\u5728\u7ebf\u5e73\u53f0\u5bfc\u51fa\u6216\u4e91\u5e94\u7528\u5546\u5e97\u5bfc\u51fa"},k.default.createElement("div",{style:{margin:"75px 21px 0 24px"}},k.default.createElement("div",{className:I.default.tit},"\u79bb\u7ebf\u5e94\u7528\u6a21\u7248\u5bfc\u5165"),k.default.createElement(c.default,{bodyStyle:{padding:"25px 0 25px 29px"},className:I.default.mb10},k.default.createElement(m.default,{className:I.default.box},k.default.createElement(h.default,{span:24,className:I.default.desc},"\u6b63\u5728\u4f7f\u7528",k.default.createElement("span",null,"\u201c",v,"\u201d"),"\u5b8c\u6210\u672c\u6b21\u5bfc\u5165\u4efb\u52a1"))),k.default.createElement(c.default,{bodyStyle:{padding:"0 0 0 27px"},className:I.default.mb10},k.default.createElement(m.default,{className:I.default.box},k.default.createElement(h.default,{span:23,className:I.default.con},"\u4e0a\u4f20Rainbond APP\u6587\u4ef6",i&&k.default.createElement(p.default,{percent:parseInt(i),size:"small",style:{width:"98%"}})),k.default.createElement(h.default,{span:1,className:I.default.rl},k.default.createElement(d.default,{showUploadList:!1,name:"appTarFile",accept:".zip,.tar",action:_.upload_url,fileList:this.state.fileList,onChange:this.onChangeUpload,onRemove:this.onRemove,headers:t},k.default.createElement(o.default,{component:e}),k.default.createElement("div",{className:I.default.upText},"\u4e0a\u4f20"))))),b&&k.default.createElement("div",null,k.default.createElement("div",{className:I.default.tit},"\u5df2\u4e0a\u4f20\u6587\u4ef6\u5217\u8868"),k.default.createElement(c.default,{className:I.default.mb10},k.default.createElement(u.default.Group,{style:{width:"100%"},onChange:this.onFileChange},k.default.createElement(m.default,null,b.map(e=>{return k.default.createElement(h.default,{key:"col".concat(e),span:24},k.default.createElement(u.default,{key:e,value:e},e))})))),k.default.createElement("div",{className:I.default.tit},"\u5bfc\u5165\u8303\u56f4"),k.default.createElement(c.default,{className:I.default.mb10},k.default.createElement(n.default.Group,{onChange:this.onChangeRadio,value:this.state.scopeValue},k.default.createElement(n.default,{style:E,value:"enterprise",disabled:!y},"\u4e0a\u4f20\u5230\u4f01\u4e1a"),k.default.createElement(n.default,{style:E,value:"team"},"\u4e0a\u4f20\u5230\u56e2\u961f",k.default.createElement(l.default,{size:"small",defaultValue:"\u8bf7\u9009\u62e9\u4e00\u4e2a\u56e2\u961f",style:{width:150,marginLeft:"15px"},onChange:this.handleChangeTeam},S&&S.map(e=>{var t=e.team_id,a=e.team_alias,s=e.team_name;return k.default.createElement(Option,{key:t,value:s},a)}))))),k.default.createElement(m.default,{style:{marginTop:"25px"}},k.default.createElement(h.default,{span:24,className:I.default.btn},k.default.createElement(r.default,{onClick:()=>{this.cancelImport()}},"\u653e\u5f03\u5bfc\u5165"),0==this.state.import_file_status.length&&k.default.createElement(r.default,{type:"primary",onClick:()=>{this.handleSubmit()}},"\u786e\u8ba4\u5bfc\u5165"))))))}},v=y))||v);t.default=C}}]);